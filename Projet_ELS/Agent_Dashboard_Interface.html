<style>
    /* Styles sp√©cifiques au Dashboard Agents - inclus via Admin_Interface */
    :root {
        --agent-card-bg: #fff;
        --agent-border-radius: 12px;
    }

    /* Vue Dashboard cach√©e par d√©faut */
    #agent-dashboard-view.hidden {
        display: none !important;
    }

    .agent-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 24px;
        padding: 24px 0;
    }

    .agent-card {
        background: var(--agent-card-bg);
        border-radius: var(--agent-border-radius);
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #e2e8f0;
        overflow: hidden;
        transition: transform 0.2s, box-shadow 0.2s;
    }

    .agent-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 12px rgba(0, 0, 0, 0.1);
    }

    .agent-header {
        padding: 16px;
        border-bottom: 1px solid #edf2f7;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .agent-name {
        font-weight: 700;
        font-size: 1.1rem;
        color: #2d3748;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .agent-role {
        font-size: 0.85rem;
        color: #718096;
        margin-top: 4px;
    }

    .agent-status {
        font-size: 0.75rem;
        padding: 4px 8px;
        border-radius: 20px;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-active {
        background: #def7ec;
        color: #03543f;
    }

    .status-idle {
        background: #edf2f7;
        color: #4a5568;
    }

    .status-error {
        background: #fde8e8;
        color: #9b1c1c;
    }

    .agent-body {
        padding: 16px;
    }

    .agent-metric {
        display: flex;
        justify-content: space-between;
        margin-bottom: 8px;
        font-size: 0.9rem;
    }

    .metric-label {
        color: #718096;
    }

    .metric-value {
        font-weight: 500;
    }

    .agent-actions {
        padding: 12px 16px;
        background: #f7fafc;
        border-top: 1px solid #edf2f7;
        display: flex;
        gap: 8px;
    }

    .btn-agent {
        flex: 1;
        padding: 8px;
        border-radius: 6px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        font-size: 0.9rem;
        transition: background 0.2s;
    }

    .btn-run {
        background: #4299e1;
        color: white;
    }

    .btn-run:hover {
        background: #3182ce;
    }

    .btn-log {
        background: #e2e8f0;
        color: #4a5568;
    }

    .btn-log:hover {
        background: #cbd5e0;
    }

    /* Terminal/Console View */
    #agent-console-output {
        background: #1a202c;
        color: #48bb78;
        font-family: 'Consolas', monospace;
        padding: 16px;
        border-radius: 8px;
        margin-top: 24px;
        height: 300px;
        overflow-y: auto;
        font-size: 0.9rem;
    }

    .log-entry {
        margin-bottom: 4px;
    }

    .log-time {
        color: #718096;
        margin-right: 8px;
    }
</style>

<div id="agent-dashboard-view" class="carte hidden">
    <h2>Tableau de Bord des Agents Jules</h2>
    <div class="agent-grid" id="agent-grid">
        <!-- Les cartes seront inject√©es ici -->
    </div>

    <h3>Journal d'activit√© Globale</h3>
    <div id="agent-console-output">
        <div class="log-entry"><span class="log-time">[System]</span> Initialisation du Dashboard Agents...</div>
    </div>
</div>

<script>
    (function () {
        // Configuration simul√©e des agents (sera remplac√©e par l'appel serveur)
        const AGENTS_DEF = [
            { id: 'sentinel', name: 'Sentinel', role: 'S√©curit√© & Int√©grit√©', schedule: '02:00 Daily', icon: 'üõ°Ô∏è' },
            { id: 'bolt', name: 'Bolt', role: 'Performance & Optimisation', schedule: '02:30 Daily', icon: '‚ö°' },
            { id: 'qualite', name: 'Agent Qualit√©', role: 'Analyse Livraisons', schedule: 'Hebdomadaire', icon: 'üìä' },
            { id: 'palette', name: 'Palette', role: 'UX & Design', schedule: 'Lun, Mer, Ven', icon: 'üé®' },
            { id: 'mechanic', name: 'Mechanic', role: 'Maintenance Code', schedule: '√Ä la demande', icon: 'üîß' }
        ];

        window.initAgentDashboard = function () {
            renderAgents({});
        };

        function renderAgents(agentsData) {
            const grid = document.getElementById('agent-grid');
            if (!grid) return;
            grid.innerHTML = '';

            AGENTS_DEF.forEach(def => {
                const data = agentsData && agentsData[def.id] ? agentsData[def.id] : { status: 'idle', lastRun: 'Jamais' };

                const card = document.createElement('div');
                card.className = 'agent-card';
                // Note: On utilise des onclick globaux ou attach√©s dynamiquement.
                // Ici encapsulation dans la closure pour plus de propret√© si possible, 
                // mais les boutons onclick HTML requi√®rent des fonctions globales.
                // On va attacher les events apr√®s.
                card.innerHTML = `
        <div class="agent-header">
          <div class="agent-name">
            <span>${def.icon}</span> ${def.name}
          </div>
          <span class="agent-status status-${data.status}">${data.status}</span>
        </div>
        <div class="agent-body">
          <div class="agent-role">${def.role}</div>
          <hr style="margin: 12px 0; border:0; border-top:1px solid #eee;">
          <div class="agent-metric">
            <span class="metric-label">Fr√©quence:</span>
            <span class="metric-value">${def.schedule}</span>
          </div>
          <div class="agent-metric">
            <span class="metric-label">Dernier run:</span>
            <span class="metric-value">${data.lastRun}</span>
          </div>
        </div>
        <div class="agent-actions">
          <button class="btn-agent btn-run" data-id="${def.id}">Lancer</button>
          <button class="btn-agent btn-log" data-id="${def.id}">Logs</button>
        </div>
      `;
                grid.appendChild(card);
            });

            // Attachement des listeners
            grid.querySelectorAll('.btn-run').forEach(btn => {
                btn.addEventListener('click', () => runAgent(btn.dataset.id));
            });
        }

        function logToConsole(msg) {
            const consoleDiv = document.getElementById('agent-console-output');
            if (!consoleDiv) return;
            const time = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = 'log-entry';
            line.innerHTML = `<span class="log-time">[${time}]</span> ${msg}`;
            consoleDiv.prepend(line);
        }

        function runAgent(agentId) {
            logToConsole(`Demande de lancement : ${agentId}...`);
            google.script.run
                .withSuccessHandler((res) => {
                    logToConsole(`R√©sultat ${agentId}: ${res}`);
                })
                .withFailureHandler((err) => {
                    logToConsole(`ERREUR ${agentId}: ${err}`);
                })
                .apiRunAgent(agentId);
        }

        // Auto init si visible
        if (document.getElementById('agent-dashboard-view') && !document.getElementById('agent-dashboard-view').classList.contains('hidden')) {
            initAgentDashboard();
        }

    })();
</script>